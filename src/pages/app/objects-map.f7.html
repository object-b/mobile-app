<template>
    <div class="page" data-name="objects-map">
        <div class="navbar">
            <div class="navbar-inner sliding">
                <div class="title">Карта объектов</div>
            </div>
        </div>
        <div class="page-content">
            <div id="global-map" class="global-object-map"></div>
        </div>

        <div class="fab fab-right-bottom">
            <a href="/create-object">
                <i class="icon f7-icons">add</i>
            </a>
        </div>
    </div>
</template>
<script>
    export default {
        data: function () {
            return {
                // user geolocation here
                userLocation: null,
                // map html object
                map: null,
            }
        },
        methods: {
            handleMapLocateControl: function () {
                var self = this;

                // self.map.locate({
                //     setView: true,
                //     maxZoom: 16,
                //     enableHighAccuracy: true,
                //     maximumAge: 0,
                //     timeout: 5000
                // });

                var locatecontrol = L.control.locate({
                    icon: 'fas fa-map-marker',
                    iconLoading: 'fas fa-spinner fa-spin',
                    strings: {
                        title: '',
                        popup: 'Вы в радиусе {distance} м. от этой точки',
                    },
                    locateOptions: {
                        maxZoom: 16,
                        enableHighAccuracy: true,
                        maximumAge: 0,
                        timeout: 5000,
                        watch: false,
                    }
                }).addTo(self.map);
                
                // Автоматическое определение при переходе
                locatecontrol.start();

                self.map.on('locationfound', this.onLocationFound);
                self.map.on('locationerror', this.onLocationError);
            },
            // Success callback
            onLocationFound: function (e) {
                var self = this;
                var app = self.$app;

                self.userLocation = {
                    latitude: e.latitude,
                    longitude: e.longitude,
                };
                
                app.data.config.debug && console.log(self.userLocation);

                // Показать маркер и иконку
                // var radius = e.accuracy;
                // var divIcon = L.divIcon({
                //     className: "leaflet-data-marker",
                //     html: L.Util.template(self.$root.iconSettings.mapIconUrl, self.$root.iconSettings),
                //     iconAnchor  : [12, 12],
                //     iconSize    : [24, 24],
                //     popupAnchor : [0, -28]
                // });
                
                // L.marker(e.latlng, {
                //     icon: divIcon,
                // }).addTo(self.map);

                // L.circle(e.latlng, radius, {
                //     weight: 0,
                //     color: '#136AEC'
                // }).addTo(self.map);
            },
            onLocationError: function (e) {
                var self = this;
                var app = self.$app;
                var msg = 'Определить локацию автоматически не удалось. Ошибка: ' + e.message;

                app.dialog.alert(msg);
            },
            getRadiusFromMapCenter: function(unit) {
                var self = this;
                var mapBoundNorthEast = self.map.getBounds().getNorthEast();
                var mapDistance = mapBoundNorthEast.distanceTo(self.map.getCenter());
                var meters = (mapDistance).toFixed(2);
                var kilometers = (mapDistance / 1000).toFixed(2);

                return unit === 'km' ? kilometers : unit === 'm' ? meters : '';
            },
        },
        on: {
            pageInit: function () {
                var self = this;
                var app = self.$app;
                var $$ = self.$$;

                if (!self.map) {
                    // L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    //     maxZoom: 18,
                    //     attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                    // }).addTo(self.map);

                    // Используется для загрузки и отображения слоев листов на карте.
                    // https://leafletjs.com/reference-1.5.0.html#tilelayer
                    var tiles = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                        maxZoom: 18,
                        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                            '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                            'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                        id: 'mapbox.streets'
                    });

                    // Создание экземпляра объекта карты с использованием идентификатора DOM элемента <div> и, необязательно, литерала объекта с параметрами карты.
                    self.map = L.map('global-map', {
                        loadingControl: true,
                        gestureHandling: false,
                        minZoom: 8,
                        layers: [tiles]
                    }).setView(self.$root.defaultMapCenter, 12);

                    // Срабатывает, когда карта перестает меняться (например, пользователь перестал перетаскивать карту).
                    self.map.on('moveend', function (e) {
                        var data = {
                            radius: self.getRadiusFromMapCenter('km'),
                            center: self.map.getCenter()
                        };
                        console.log(data);

                        // config.debug && L.marker(self.map.getCenter()).addTo(self.map);
                        // config.debug && L.circle(
                        //     self.map.getCenter(), 
                        //     parseInt(self.getRadiusFromMapCenter('m'))
                        // ).addTo(self.map);
                    });

                    // Нужно получить точки только на видимой области карты
                    var addressPoints = [
                    [54.39, 48.21, 'svalka'],
[54.38, 48.21, 'svalka'],
[54.39, 48.21, 'svalka'],
[54.38, 48.21, 'svalka'],
[54.32, 48.21, 'svalka'],
[54.33, 48.21, 'svalka'],
[54.37, 48.21, 'svalka'],
[54.38, 48.21, 'svalka'],
[54.33, 48.21, 'svalka'],
[54.33, 48.21, 'svalka'],
[54.36, 48.21, 'svalka'],
[54.36, 48.22, 'svalka'],
[54.37, 48.22, 'svalka'],
[54.36, 48.22, 'svalka'],
[54.34, 48.22, 'svalka'],
[54.39, 48.22, 'svalka'],
[54.34, 48.22, 'svalka'],
[54.36, 48.22, 'svalka'],
[54.37, 48.22, 'svalka'],
[54.36, 48.23, 'svalka'],
[54.4, 48.23, 'svalka'],
[54.33, 48.23, 'svalka'],
[54.39, 48.23, 'svalka'],
[54.35, 48.23, 'svalka'],
[54.32, 48.23, 'svalka'],
[54.41, 48.24, 'svalka'],
[54.37, 48.24, 'svalka'],
[54.33, 48.24, 'svalka'],
[54.38, 48.24, 'svalka'],
[54.34, 48.24, 'svalka'],
[54.38, 48.24, 'svalka'],
[54.39, 48.24, 'svalka'],
[54.36, 48.24, 'svalka'],
[54.33, 48.24, 'svalka'],
[54.33, 48.24, 'svalka'],
[54.35, 48.25, 'svalka'],
[54.37, 48.25, 'svalka'],
[54.39, 48.25, 'svalka'],
[54.35, 48.25, 'svalka'],
[54.39, 48.25, 'svalka'],
[54.36, 48.25, 'svalka'],
[54.37, 48.25, 'svalka'],
[54.33, 48.25, 'svalka'],
[54.36, 48.25, 'svalka'],
[54.35, 48.25, 'svalka'],
[54.36, 48.25, 'svalka'],
[54.38, 48.25, 'svalka'],
[54.33, 48.26, 'svalka'],
[54.4, 48.26, 'svalka'],
[54.32, 48.26, 'svalka'],
[54.38, 48.26, 'svalka'],
[54.32, 48.26, 'svalka'],
[54.35, 48.26, 'svalka'],
[54.4, 48.26, 'svalka'],
[54.37, 48.26, 'svalka'],
[54.4, 48.26, 'svalka'],
[54.4, 48.26, 'svalka'],
[54.34, 48.27, 'svalka'],
[54.35, 48.27, 'svalka'],
[54.37, 48.27, 'svalka'],
[54.33, 48.27, 'svalka'],
[54.4, 48.27, 'svalka'],
[54.35, 48.27, 'svalka'],
[54.35, 48.27, 'svalka'],
[54.4, 48.27, 'svalka'],
[54.33, 48.27, 'svalka'],
[54.32, 48.27, 'svalka'],
[54.35, 48.28, 'svalka'],
[54.39, 48.28, 'svalka'],
[54.37, 48.28, 'svalka'],
[54.41, 48.28, 'svalka'],
[54.36, 48.28, 'svalka'],
[54.39, 48.28, 'svalka'],
[54.37, 48.28, 'svalka'],
[54.33, 48.28, 'svalka'],
[54.4, 48.28, 'svalka'],
[54.35, 48.29, 'svalka'],
[54.34, 48.29, 'svalka'],
[54.32, 48.29, 'svalka'],
[54.35, 48.29, 'svalka'],
[54.35, 48.29, 'svalka'],
[54.36, 48.29, 'svalka'],
[54.36, 48.29, 'svalka'],
[54.34, 48.3, 'svalka'],
[54.32, 48.3, 'svalka'],
[54.33, 48.3, 'svalka'],
[54.32, 48.3, 'svalka'],
[54.37, 48.3, 'svalka'],
[54.38, 48.3, 'svalka'],
[54.34, 48.3, 'svalka'],
[54.35, 48.3, 'svalka'],
[54.4, 48.3, 'svalka'],
[54.35, 48.31, 'svalka'],
[54.37, 48.31, 'svalka'],
[54.4, 48.31, 'svalka'],
[54.4, 48.31, 'svalka'],
[54.39, 48.31, 'svalka'],
[54.39, 48.31, 'svalka'],
[54.36, 48.32, 'svalka'],
[54.34, 48.32, 'svalka'],
[54.35, 48.32, 'svalka'],
[54.33, 48.32, 'svalka'],
[54.37, 48.32, 'svalka'],
[54.33, 48.32, 'svalka'],
[54.35, 48.32, 'svalka'],
[54.37, 48.32, 'svalka'],
[54.34, 48.32, 'svalka'],
[54.35, 48.32, 'svalka'],
[54.33, 48.32, 'svalka'],
[54.4, 48.33, 'svalka'],
[54.37, 48.33, 'svalka'],
[54.33, 48.33, 'svalka'],
[54.37, 48.33, 'svalka'],
[54.4, 48.33, 'svalka'],
[54.37, 48.33, 'svalka'],
[54.32, 48.33, 'svalka'],
[54.39, 48.34, 'svalka'],
[54.37, 48.34, 'svalka'],
[54.37, 48.34, 'svalka'],
[54.38, 48.34, 'svalka'],
[54.33, 48.34, 'svalka'],
[54.34, 48.34, 'svalka'],
[54.4, 48.34, 'svalka'],
[54.36, 48.34, 'svalka'],
[54.33, 48.34, 'svalka'],
[54.34, 48.34, 'svalka'],
[54.33, 48.35, 'svalka'],
[54.37, 48.35, 'svalka'],
[54.4, 48.35, 'svalka'],
[54.36, 48.35, 'svalka'],
[54.37, 48.35, 'svalka'],
[54.32, 48.35, 'svalka'],
[54.36, 48.35, 'svalka'],
[54.34, 48.35, 'svalka'],
[54.41, 48.35, 'svalka'],
[54.38, 48.35, 'svalka'],
[54.39, 48.35, 'svalka'],
[54.33, 48.35, 'svalka'],
[54.4, 48.35, 'svalka'],
[54.37, 48.35, 'svalka'],
[54.4, 48.36, 'svalka'],
[54.34, 48.36, 'svalka'],
[54.38, 48.36, 'svalka'],
[54.34, 48.36, 'svalka'],
[54.32, 48.36, 'svalka'],
[54.36, 48.36, 'svalka'],
[54.4, 48.36, 'svalka'],
[54.38, 48.36, 'svalka'],
[54.33, 48.36, 'svalka'],
[54.33, 48.36, 'svalka'],
[54.35, 48.36, 'svalka'],
[54.35, 48.36, 'svalka'],
[54.38, 48.37, 'svalka'],
[54.32, 48.37, 'svalka'],
[54.32, 48.37, 'svalka'],
[54.33, 48.37, 'svalka'],
[54.39, 48.37, 'svalka'],
[54.39, 48.37, 'svalka'],
[54.34, 48.37, 'svalka'],
[54.34, 48.37, 'svalka'],
[54.36, 48.37, 'svalka'],
[54.36, 48.37, 'svalka'],
[54.37, 48.37, 'svalka'],
[54.33, 48.37, 'svalka'],
[54.34, 48.37, 'svalka'],
[54.34, 48.38, 'svalka'],
[54.35, 48.38, 'svalka'],
[54.36, 48.38, 'svalka'],
[54.33, 48.38, 'svalka'],
[54.34, 48.38, 'svalka'],
[54.36, 48.38, 'svalka'],
[54.33, 48.38, 'svalka'],
[54.38, 48.38, 'svalka'],
[54.32, 48.38, 'svalka'],
[54.38, 48.38, 'svalka'],
[54.36, 48.38, 'svalka'],
[54.37, 48.38, 'svalka'],
[54.4, 48.38, 'svalka'],
[54.37, 48.39, 'svalka'],
[54.34, 48.39, 'svalka'],
[54.38, 48.39, 'svalka'],
[54.34, 48.39, 'svalka'],
[54.34, 48.39, 'svalka'],
[54.34, 48.39, 'svalka'],
[54.4, 48.39, 'svalka'],
[54.38, 48.39, 'svalka'],
[54.33, 48.39, 'svalka'],
[54.35, 48.4, 'svalka'],
[54.35, 48.4, 'svalka'],
[54.33, 48.4, 'svalka'],
[54.39, 48.4, 'svalka'],
[54.39, 48.4, 'svalka'],
[54.37, 48.4, 'svalka'],
[54.38, 48.4, 'svalka'],
[54.36, 48.4, 'svalka'],
[54.4, 48.4, 'svalka'],
[54.32, 48.4, 'svalka'],
[54.41, 48.4, 'svalka'],
[54.34, 48.4, 'svalka'],
[54.4, 48.41, 'svalka'],
[54.35, 48.41, 'svalka'],
[54.41, 48.41, 'svalka'],
[54.37, 48.41, 'svalka'],
[54.36, 48.41, 'svalka'],
[54.39, 48.41, 'svalka'],
[54.36, 48.41, 'svalka'],
[54.39, 48.41, 'svalka'],
[54.35, 48.41, 'svalka'],
[54.36, 48.42, 'svalka'],
[54.37, 48.42, 'svalka'],
[54.37, 48.42, 'svalka'],
[54.4, 48.42, 'svalka'],
[54.34, 48.42, 'svalka'],
[54.38, 48.42, 'svalka'],
[54.32, 48.42, 'svalka'],
[54.38, 48.42, 'svalka'],
[54.36, 48.42, 'svalka'],
[54.37, 48.42, 'svalka'],
[54.35, 48.42, 'svalka'],
[54.32, 48.42, 'svalka'],
[54.41, 48.43, 'svalka'],
[54.39, 48.43, 'svalka'],
[54.33, 48.43, 'svalka'],
[54.35, 48.43, 'svalka'],
[54.32, 48.43, 'svalka'],
[54.36, 48.43, 'svalka'],
[54.33, 48.44, 'svalka'],
[54.33, 48.44, 'svalka'],
[54.39, 48.44, 'svalka'],
[54.38, 48.44, 'svalka'],
[54.39, 48.44, 'svalka'],
[54.39, 48.44, 'svalka'],
[54.38, 48.45, 'svalka'],
[54.39, 48.45, 'svalka'],
[54.36, 48.45, 'svalka'],
[54.41, 48.45, 'svalka'],
[54.36, 48.45, 'svalka'],
[54.36, 48.45, 'svalka'],
[54.36, 48.45, 'svalka'],
[54.37, 48.45, 'svalka'],
[54.39, 48.45, 'svalka'],
[54.4, 48.45, 'svalka'],
[54.41, 48.46, 'svalka'],
[54.32, 48.46, 'svalka'],
[54.36, 48.46, 'svalka'],
[54.36, 48.46, 'svalka'],
[54.36, 48.46, 'svalka'],
[54.39, 48.46, 'svalka'],
[54.37, 48.46, 'svalka'],
[54.33, 48.46, 'svalka'],
[54.34, 48.46, 'svalka'],
[54.38, 48.46, 'svalka'],
[54.35, 48.47, 'svalka'],
[54.35, 48.47, 'svalka'],
[54.34, 48.47, 'svalka'],
[54.37, 48.47, 'svalka'],
[54.35, 48.48, 'svalka'],
[54.38, 48.48, 'svalka'],
[54.33, 48.48, 'svalka'],
[54.34, 48.48, 'svalka'],
[54.36, 48.48, 'svalka'],
[54.4, 48.48, 'svalka'],
[54.34, 48.48, 'svalka'],
[54.36, 48.48, 'svalka'],
[54.37, 48.48, 'svalka'],
[54.37, 48.48, 'svalka'],
[54.37, 48.48, 'svalka'],
[54.39, 48.48, 'svalka'],
[54.35, 48.48, 'svalka'],
[54.33, 48.49, 'svalka'],
[54.34, 48.49, 'svalka'],
[54.39, 48.49, 'svalka'],
[54.38, 48.49, 'svalka'],
[54.34, 48.49, 'svalka'],
[54.36, 48.49, 'svalka'],
[54.4, 48.49, 'svalka'],
[54.39, 48.49, 'svalka'],
[54.36, 48.49, 'svalka'],
[54.4, 48.49, 'svalka'],
[54.37, 48.5, 'svalka'],
[54.38, 48.5, 'svalka'],
[54.38, 48.5, 'svalka'],
[54.35, 48.5, 'svalka'],
[54.33, 48.5, 'svalka'],
[54.37, 48.5, 'svalka'],
[54.39, 48.5, 'svalka'],
[54.4, 48.5, 'svalka'],
[54.32, 48.5, 'svalka'],
[54.37, 48.51, 'svalka'],
[54.39, 48.51, 'svalka'],
[54.32, 48.51, 'svalka'],
[54.36, 48.51, 'svalka'],
[54.35, 48.51, 'svalka'],
[54.38, 48.51, 'svalka'],
[54.33, 48.51, 'svalka'],
[54.34, 48.51, 'svalka'],
[54.36, 48.51, 'svalka'],
[54.35, 48.51, 'svalka'],
[54.39, 48.51, 'svalka'],
[54.41, 48.51, 'svalka'],
[54.34, 48.51, 'svalka'],
[54.37, 48.51, 'svalka'],
[54.35, 48.51, 'svalka'],
[54.33, 48.51, 'svalka'],
[54.35, 48.52, 'svalka'],
[54.36, 48.52, 'svalka'],
[54.36, 48.52, 'svalka'],
[54.4, 48.52, 'svalka'],
[54.38, 48.52, 'svalka'],
[54.38, 48.52, 'svalka'],
[54.36, 48.52, 'svalka'],
[54.37, 48.53, 'svalka'],
[54.38, 48.53, 'svalka'],
[54.39, 48.53, 'svalka'],
[54.37, 48.53, 'svalka'],
[54.36, 48.53, 'svalka'],
[54.39, 48.53, 'svalka'],
[54.35, 48.53, 'svalka'],
[54.34, 48.54, 'svalka'],
[54.39, 48.54, 'svalka'],
[54.36, 48.54, 'svalka'],
[54.34, 48.54, 'svalka'],
[54.33, 48.54, 'svalka'],
[54.4, 48.54, 'svalka'],
[54.32, 48.54, 'svalka'],
[54.38, 48.54, 'svalka'],
[54.4, 48.54, 'svalka'],
[54.41, 48.54, 'svalka'],
[54.4, 48.55, 'svalka'],
[54.4, 48.55, 'svalka'],
[54.36, 48.55, 'svalka'],
[54.32, 48.55, 'svalka'],
[54.4, 48.55, 'svalka'],
[54.37, 48.55, 'svalka'],
[54.33, 48.55, 'svalka'],
[54.36, 48.55, 'svalka'],
[54.38, 48.55, 'svalka'],
[54.37, 48.55, 'svalka'],
[54.33, 48.55, 'svalka'],
[54.34, 48.56, 'svalka'],
[54.34, 48.56, 'svalka'],
[54.33, 48.56, 'svalka'],
[54.34, 48.56, 'svalka'],
[54.4, 48.56, 'svalka'],
[54.36, 48.57, 'svalka'],
[54.39, 48.57, 'svalka'],
[54.38, 48.57, 'svalka'],
[54.32, 48.57, 'svalka'],
[54.34, 48.57, 'svalka'],
[54.34, 48.57, 'svalka'],
[54.38, 48.57, 'svalka'],
[54.36, 48.57, 'svalka'],
[54.38, 48.57, 'svalka'],
[54.4, 48.57, 'svalka'],
[54.39, 48.57, 'svalka'],
[54.36, 48.58, 'svalka'],
[54.35, 48.58, 'svalka'],
[54.38, 48.58, 'svalka'],
[54.4, 48.58, 'svalka'],
[54.36, 48.58, 'svalka'],
[54.37, 48.58, 'svalka'],
[54.4, 48.58, 'svalka'],
[54.33, 48.59, 'svalka'],
[54.39, 48.59, 'svalka'],
[54.32, 48.59, 'svalka'],
[54.39, 48.59, 'svalka'],
[54.35, 48.59, 'svalka'],
[54.41, 48.59, 'svalka'],
[54.39, 48.59, 'svalka'],
[54.36, 48.59, 'svalka'],
[54.34, 48.59, 'svalka'],
[54.38, 48.59, 'svalka'],
[54.38, 48.59, 'svalka'],
[54.36, 48.59, 'svalka'],
[54.36, 48.6, 'svalka'],
[54.41, 48.6, 'svalka'],
[54.33, 48.6, 'svalka'],
[54.36, 48.6, 'svalka'],
[54.4, 48.6, 'svalka'],
[54.34, 48.6, 'svalka'],
[54.4, 48.6, 'svalka'],
[54.38, 48.6, 'svalka'],
[54.37, 48.6, 'svalka'],
[54.33, 48.6, 'svalka'],
[54.35, 48.61, 'svalka'],
[54.4, 48.61, 'svalka'],
[54.34, 48.61, 'svalka'],
[54.38, 48.61, 'svalka'],
[54.36, 48.61, 'svalka'],
[54.37, 48.61, 'svalka'],
[54.37, 48.61, 'svalka'],
[54.41, 48.62, 'svalka'],
[54.33, 48.62, 'svalka'],
[54.41, 48.62, 'svalka'],
[54.33, 48.62, 'svalka'],
[54.38, 48.62, 'svalka'],
[54.39, 48.62, 'svalka'],
[54.33, 48.62, 'svalka'],
[54.33, 48.62, 'svalka'],
[54.35, 48.62, 'svalka'],
[54.38, 48.62, 'svalka'],
[54.33, 48.62, 'svalka'],
[54.35, 48.62, 'svalka'],
[54.32, 48.62, 'svalka'],
[54.38, 48.63, 'svalka'],
[54.35, 48.63, 'svalka'],
[54.37, 48.63, 'svalka'],
[54.33, 48.63, 'svalka'],
[54.4, 48.63, 'svalka'],
[54.36, 48.63, 'svalka'],
[54.35, 48.63, 'svalka'],
[54.4, 48.63, 'svalka'],
[54.35, 48.63, 'svalka'],
[54.36, 48.63, 'svalka'],
[54.35, 48.64, 'svalka'],
[54.4, 48.64, 'svalka'],
[54.38, 48.64, 'svalka'],
[54.39, 48.64, 'svalka'],
[54.38, 48.64, 'svalka'],
[54.35, 48.64, 'svalka'],
[54.41, 48.64, 'svalka'],
[54.34, 48.64, 'svalka'],
[54.41, 48.64, 'svalka'],
[54.34, 48.64, 'svalka'],
[54.35, 48.64, 'svalka'],
[54.35, 48.64, 'svalka'],
[54.33, 48.65, 'svalka'],
[54.39, 48.65, 'svalka'],
[54.36, 48.65, 'svalka'],
[54.37, 48.65, 'svalka'],
[54.41, 48.65, 'svalka'],
[54.39, 48.65, 'svalka'],
[54.36, 48.65, 'svalka'],
[54.32, 48.65, 'svalka'],
[54.32, 48.65, 'svalka'],
[54.36, 48.65, 'svalka'],
[54.38, 48.65, 'svalka'],
[54.35, 48.65, 'svalka'],
[54.35, 48.66, 'svalka'],
[54.36, 48.66, 'svalka'],
[54.33, 48.66, 'svalka'],
[54.33, 48.66, 'svalka'],
[54.35, 48.66, 'svalka'],
[54.33, 48.66, 'svalka'],
[54.35, 48.66, 'svalka'],
[54.34, 48.66, 'svalka'],
[54.34, 48.66, 'svalka'],
[54.35, 48.66, 'svalka'],
[54.35, 48.66, 'svalka'],
[54.36, 48.66, 'svalka'],
[54.34, 48.67, 'svalka'],
[54.39, 48.67, 'svalka'],
[54.37, 48.67, 'svalka'],
[54.4, 48.67, 'svalka'],
[54.38, 48.67, 'svalka'],
[54.34, 48.67, 'svalka'],
[54.41, 48.67, 'svalka'],
[54.41, 48.67, 'svalka'],
[54.35, 48.67, 'svalka'],
[54.35, 48.68, 'svalka'],
[54.37, 48.68, 'svalka'],
[54.36, 48.68, 'svalka'],
[54.39, 48.68, 'svalka'],
[54.38, 48.68, 'svalka'],
[54.33, 48.68, 'svalka'],
[54.39, 48.68, 'svalka'],
[54.37, 48.68, 'svalka'],
[54.37, 48.68, 'svalka'],
[54.39, 48.68, 'svalka'],
[54.32, 48.68, 'svalka'],
[54.39, 48.68, 'svalka'],
[54.33, 48.68, 'svalka'],
[54.38, 48.69, 'svalka'],
[54.37, 48.69, 'svalka'],
[54.4, 48.69, 'svalka'],
[54.32, 48.69, 'svalka'],
[54.41, 48.69, 'svalka'],
[54.37, 48.69, 'svalka'],
[54.4, 48.69, 'svalka'],
[54.36, 48.69, 'svalka'],
[54.34, 48.69, 'svalka'],
[54.34, 48.69, 'svalka'],
[54.37, 48.69, 'svalka'],
[54.38, 48.69, 'svalka'],
[54.33, 48.7, 'svalka'],
[54.33, 48.7, 'svalka'],
[54.35, 48.7, 'svalka'],
[54.34, 48.7, 'svalka'],
[54.37, 48.7, 'svalka'],
[54.35, 48.71, 'svalka'],
[54.35, 48.71, 'svalka'],
[54.38, 48.71, 'svalka'],
[54.32, 48.71, 'svalka'],
[54.39, 48.71, 'svalka'],
[54.33, 48.71, 'svalka'],
[54.36, 48.71, 'svalka'],
[54.39, 48.71, 'svalka'],
[54.35, 48.71, 'svalka'],
[54.34, 48.71, 'svalka'],
[54.39, 48.72, 'svalka'],
];
                    
                    var markers = L.markerClusterGroup({
                        chunkedLoading: true,
                        spiderfyOnMaxZoom: false,
                        removeOutsideVisibleBounds: true
                    });
                    
                    // for (var i = 0; i < addressPoints.length; i++) {
                    //     var a = addressPoints[i];
                    //     var title = a[2];
                    //     var marker = L.marker(new L.LatLng(a[0], a[1]), { title: title });
                    //     marker.bindPopup(title);
                    //     markers.addLayer(marker);
                    // }

                    // self.map.addLayer(markers);


                    // L.polygon([
                    //     [54.3057, 48.3662],
                    //     [54.2954, 48.3904],
                    //     [54.3002, 48.3773]
                    // ], {opacity: '.5'}).addTo(self.map);
                }

                self.handleMapLocateControl();
            },
        }
    };
</script>