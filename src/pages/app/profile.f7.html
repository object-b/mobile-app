<template>
    <div class="page" data-name="profile">
        <div class="navbar">
            <div class="navbar-inner">
                <div class="title">Ваш профиль</div>
                <div class="right">
                    <a href="#" class="link" @click="logout">
                        <i class="f7-icons if-not-md">exit</i>
                        <i class="material-icons md-only">exit_to_app</i>
                        <span>Выход</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Scrollable page content-->
        <div class="page-content">
            {{#if user}}
                <div class="list simple-list">
                    <ul>
                        <li>Name: {{user.name}}</li>
                        <li>API Key: {{user.api_key}}</li>
                    </ul>
                </div>
            {{/if}}
        </div>
    </div>
</template>
<script>
    import auth from '../../js/auth';

    export default {
        data() {
            return {
                // empty initial user data
                user: null,
            }
        },
        methods: {
            logout: function () {
                var router = this.$f7router;
                var app = this.$f7;

                app.dialog.confirm('Вы действительно хотите выйти из учетной записи?', function () {
                    auth.logoutUser().then(function () {
                        location.reload();
                    });
                });
            },
        },
        on: {
            pageInit: function (e, page) {
                var self = this;
                var app = self.$app;

                auth.getUserProfileInfo().then(function (user) {
                    self.$setState({
                        user: user,
                    });
                }).catch(function() {
                    console.error('Данные потерялись');
                });
            },
        }
    }
</script>